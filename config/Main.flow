COPIAR en NODE-RED toda la lÃ­nea entre [ ]


[{"id":"39a41763.6aed08","type":"subflow","name":"VoiceRecognition","info":"","in":[{"x":214,"y":114,"wires":[{"id":"3fffb177.86ca1e"}]}],"out":[{"x":1011,"y":206,"wires":[{"id":"36d7321b.624c7e","port":0}]}]},{"id":"3fffb177.86ca1e","type":"function","z":"39a41763.6aed08","name":"get voice filename","func":"var voiceFileID = msg.payload;\nvar botToken = global.get('botToken');\n\nmsg.url  = 'https://api.telegram.org/bot' + botToken +'/getFile?file_id=' + voiceFileID;\nreturn msg;","outputs":1,"noerr":0,"x":452,"y":116,"wires":[["b6f5d846.cf6f"]]},{"id":"e0e31f63.db623","type":"watson-speech-to-text","z":"39a41763.6aed08","name":"SpeechToText","continuous":true,"lang":"es-ES","langhidden":"es-ES","band":"BroadbandModel","bandhidden":"","password":"IYwODsXmS3mJ","x":634,"y":198,"wires":[["36d7321b.624c7e"]]},{"id":"297b2c67.da24cc","type":"function","z":"39a41763.6aed08","name":"retrieve voice","func":"var botToken = global.get('botToken');\nvar filePath = '';\n\nif (msg.payload.ok && msg.payload.ok === true)\n{\n    filePath = msg.payload.result.file_path;\n    msg.url = 'https://api.telegram.org/file/bot' + botToken +'/' + filePath ;\n\n}\nmsg.headers = '';\nmsg.method = '';\nreturn msg;","outputs":1,"noerr":0,"x":228,"y":197,"wires":[["c91ccaa9.79d338"]]},{"id":"b6f5d846.cf6f","type":"http request","z":"39a41763.6aed08","name":"","method":"GET","ret":"obj","url":"","x":674,"y":115,"wires":[["297b2c67.da24cc"]]},{"id":"c91ccaa9.79d338","type":"http request","z":"39a41763.6aed08","name":"","method":"GET","ret":"bin","url":"","x":430,"y":197,"wires":[["e0e31f63.db623"]]},{"id":"36d7321b.624c7e","type":"function","z":"39a41763.6aed08","name":"toPayload","func":"msg.payload = msg.transcription;\ndelete msg.transcription;\nreturn msg;","outputs":1,"noerr":0,"x":849,"y":199,"wires":[[]]},{"id":"89e87d87.534338","type":"telegram receiver","z":"ce208ae.5292978","name":"BOT Receive","bot":"bc463ef3.f6d2a","x":94.85000610351562,"y":50.849998474121094,"wires":[[],["6376b058.b091c","e6d1682.3cbf198"]]},{"id":"6376b058.b091c","type":"debug","z":"ce208ae.5292978","name":"","active":true,"console":"false","complete":"true","x":267.04998779296875,"y":60.35002136230469,"wires":[]},{"id":"e6d1682.3cbf198","type":"function","z":"ce208ae.5292978","name":"saveSourceMsg & Settings","func":"// Save some context settings\nflow.set('sesionTimeout', 1*3600*1000); // 1h\nglobal.set('botToken', '262348393:AAEAGKXzkYwWTj4DAyaSeSPAYXYC9Z7af3I');\nflow.set('workspaceID', '52866da8-1666-46aa-a211-2584434ce125');\nflow.set('cityName', 'Gotham City')\nglobal.set('reqConfidence', '0.5');\n\n// Save sourceMsg \nmsg.sourceMsg = JSON.parse(JSON.stringify(msg));\n\n// Parse and store msgType\nif (msg.payload.type == \"message\" && msg.originalMessage.entities && msg.originalMessage.entities[0].type == \"bot_command\")\n    msg.msgType = msg.originalMessage.entities[0].type;\nelse msg.msgType = msg.payload.type;\n\n// Get chatID from sourceMsg originalMessage \n// and prepare to get profile from cloudant\nvar chatID = msg.sourceMsg.originalMessage.from.id;\nmsg.payload = chatID;\nreturn msg;","outputs":1,"noerr":0,"x":240.0500030517578,"y":103.85000610351562,"wires":[["6101bda7.a0d2d4"]]},{"id":"6101bda7.a0d2d4","type":"cloudant in","z":"ce208ae.5292978","name":"Retrieve Profile","cloudant":"","database":"telegramprofiles_v2","service":"cloudant-nosql-db","search":"_id_","design":"","index":"","x":475.0500030517578,"y":106.85002136230469,"wires":[["8fbb34c2.250e68","c0482842.47b8a"]]},{"id":"8fbb34c2.250e68","type":"function","z":"ce208ae.5292978","name":"check Profile existence (1 = no )","func":"// Validate if profile object existed. \n// If not, create a new one\nif (!msg.payload || msg.payload instanceof String)\n     return [ msg , null] ;\nelse     \n{\n     msg.profile = msg.payload; \n     return [ null , msg] ;\n}","outputs":"2","noerr":0,"x":726.0500030517578,"y":107.85002136230469,"wires":[["79bffe57.727b2"],["8bf8f074.ef8b9"]]},{"id":"79bffe57.727b2","type":"function","z":"ce208ae.5292978","name":"create new Profile","func":"msg.profile = {\n    '_id' : msg.sourceMsg.originalMessage.from.id.toString() ,\n    'user' : { 'id' : msg.sourceMsg.originalMessage.from.id.toString(),\n               'firstName' : msg.sourceMsg.originalMessage.from.first_name , \n               'lastName' : msg.sourceMsg.originalMessage.from.last_name\n    },\n    'lastConversation' : { 'workspaceID' : '',\n                     'timestamp' : ''\n    },\n    'history' : [],\n    'lastTimestamp' : ''\n};\n//msg.payload = JSON.parse(JSON.stringify(msg.profile));\nreturn msg;","outputs":1,"noerr":0,"x":1007.0500183105469,"y":89.85002136230469,"wires":[["8bf8f074.ef8b9"]]},{"id":"8bf8f074.ef8b9","type":"function","z":"ce208ae.5292978","name":"extract Conversation Settings","func":"var timeout = flow.get('sesionTimeout')\nvar now = Date.now();\nvar lastTimestamp = msg.profile.lastTimestamp;\n\nif (now - lastTimestamp > timeout)\n    msg.session_status = \"new\";\nelse\n    msg.session_status = \"resume\";\n\nmsg.settings = JSON.parse(JSON.stringify(msg.profile.lastConversation));\n\nreturn msg;","outputs":1,"noerr":0,"x":603.0499725341797,"y":187.85002899169922,"wires":[["bcb4bb6d.ead2d"]]},{"id":"bcb4bb6d.ead2d","type":"switch","z":"ce208ae.5292978","name":"Type of Msg","property":"msgType","propertyType":"msg","rules":[{"t":"eq","v":"voice","vt":"str"},{"t":"eq","v":"bot_command","vt":"str"},{"t":"eq","v":"message","vt":"str"},{"t":"else"}],"checkall":"true","outputs":4,"x":850.0499114990234,"y":186.85002899169922,"wires":[["e0a7dd70.61383"],["bde710ae.7b1e5"],["4c0a71a1.41ae38"],[]]},{"id":"6b8fb91f.02cb88","type":"debug","z":"ce208ae.5292978","name":"","active":false,"console":"false","complete":"true","x":1214.050064086914,"y":808.849983215332,"wires":[]},{"id":"197277b1.d19918","type":"function","z":"ce208ae.5292978","name":"getVoiceId","func":"msg.payload = msg.sourceMsg.payload.content;\nreturn msg;","outputs":1,"noerr":0,"x":856.0500640869141,"y":773.3499755859375,"wires":[["33c0a745.1e129"]]},{"id":"1c864979.d3607f","type":"function","z":"ce208ae.5292978","name":"toTextMsg","func":"msg.convertedMsg = msg.payload.toLowerCase();\nmsg.sourceMsg.payload.content = msg.convertedMsg;\nmsg.sourceMsg.payload.type = 'message';\n//msg.sourceMsg.originalMessage.text = msg.payload;\n//msg.sourceMsg.originalMessage.chat.type = 'message';\n//delete msg.sourceMsg.originalMessage.voice;\nreturn msg;","outputs":1,"noerr":0,"x":1010.0500640869141,"y":810.3499755859375,"wires":[["6b8fb91f.02cb88","39dbee43.4266fa"]]},{"id":"596969da.512b98","type":"npm","z":"ce208ae.5292978","name":"","func":"// NPM module exposed as variable, npm_module\nreturn npm_module(msg.transcription).remove;","npm_module":"diacritics","module_style":"function","msg_payload":"return_val","function_name":"remove","x":852.0501098632812,"y":810.3499755859375,"wires":[["1c864979.d3607f"]]},{"id":"fb545e6a.250d38","type":"function","z":"ce208ae.5292978","name":"prepare Conversation","func":"// Retrieve some context variables\nvar workspaceID = flow.get('workspaceID');\nvar cityName = flow.get('cityName');\nvar reqConfidence = global.get('reqConfidence');\n\n\nmsg.params = {};\n// If a new session, add the workspaceID\nif (msg.session_status == 'new')\n{\n    msg.settings.workspaceID = workspaceID;\n    if (msg.settings.context)\n    {\n        msg.params.context = msg.settings.context;\n        msg.params.context.conversation_id = '';\n        msg.params.context.system = {};\n    } else \n        msg.params.context = { 'firstName' : msg.profile.user.firstName ,'lastName' : msg.profile.user.lastName , 'cityName' : cityName, 'reqConfidence' : reqConfidence };\n}\nelse  msg.params.context = msg.settings.context;\n    \nmsg.payload = msg.sourceMsg.payload.content;\nmsg.params.context.reqConfidence = reqConfidence;\nreturn msg;\n","outputs":"1","noerr":0,"x":270.0499725341797,"y":308.85003662109375,"wires":[["a7cac91b.e46998","55e1c17e.a3f348"]]},{"id":"ad195ba3.22a49","type":"function","z":"ce208ae.5292978","name":"Save settings & response (1 = command)","func":"// Save dialog settings\n//msg.settings.userID = msg.dialog.client_id;\nmsg.settings.context = msg.payload.context;\nmsg.settings.timestamp = Date.now();\n\n// Copy dialog settings to profile\nmsg.profile.lastConversation = JSON.parse(JSON.stringify(msg.settings));\n\n// Save dialog response\nvar responseMsg = msg.payload.output.text;\n//node.send(responseMsg[0]);\n\n// Prepare to save the interaction log\nmsg.ConversationOUT = {};\nmsg.ConversationOUT.conversationID = msg.settings.context.conversationID;\nmsg.ConversationOUT.userEntry = msg.sourceMsg.payload.content;\n\n// Convert output in command format\nvar respObject;\nif (responseMsg[0].substring(0, 2) == '%%')\n{\n    respObject = responseMsg[0].split('%');\n    msg.ConversationOUT.cmdtype = respObject[2];\n    msg.ConversationOUT.command = respObject[3];\n} else {\n    msg.ConversationOUT.cmdtype = 'TEXT';\n    msg.ConversationOUT.command = '';\n    msg.ConversationOUT.text = '';\n    for (var i = 0 ; i < responseMsg.length ; i++)\n        msg.ConversationOUT.text = msg.ConversationOUT.text.concat(responseMsg[i]).concat(\"\\n\\n\");\n}\n\nmsg.ConversationOUT.intents = msg.payload.intents;\nmsg.ConversationOUT.newContext = msg.payload.output.context;\nmsg.ConversationOUT.logMsgs = msg.payload.output.log_messages;\nmsg.ConversationOUT.timestamp = Date.now();\n\nreturn msg;\n","outputs":"1","noerr":0,"x":972.0499267578125,"y":307.8500061035156,"wires":[["23600c12.6a6124","754e71a.4fd8d1"]]},{"id":"24405fc3.8b66e8","type":"debug","z":"ce208ae.5292978","name":"","active":false,"console":"false","complete":"dialog","x":548.0499572753906,"y":668.3500671386719,"wires":[]},{"id":"a9bdc995.ca5a3","type":"cloudant out","z":"ce208ae.5292978","name":"save profile","cloudant":"","database":"telegramprofiles_v2","service":"cloudant-nosql-db","payonly":true,"operation":"insert","x":1381.0499267578125,"y":584.85009765625,"wires":[]},{"id":"e3d80864.90638","type":"function","z":"ce208ae.5292978","name":"prepare Chat Response","func":"// Recover the original Telegram message\nmsg.payload = msg.sourceMsg.payload\n\n// Set the text as content\nmsg.payload.content = msg.ConversationOUT.text;\n\n// Adjust the right Telegram sendMsg options\nif (!msg.ConversationOUT.options)\n    // Default ones if not pre-fixed\n    msg.payload.options = {parse_mode : 'HTML' , disable_web_page_preview : 'true'};\nelse\n    msg.payload.options = msg.ConversationOUT.options;\nreturn msg;","outputs":1,"noerr":0,"x":762.0499572753906,"y":636.8500671386719,"wires":[["468db72.ab6d248"]]},{"id":"468db72.ab6d248","type":"telegram sender","z":"ce208ae.5292978","name":"BOT Sender","bot":"bc463ef3.f6d2a","x":997.0499572753906,"y":636.8500671386719,"wires":[["ed30b4e8.0b73f8"]]},{"id":"ed30b4e8.0b73f8","type":"debug","z":"ce208ae.5292978","name":"","active":true,"console":"false","complete":"payload","x":1228.0499572753906,"y":636.8500671386719,"wires":[]},{"id":"2d3c19e2.ef598e","type":"switch","z":"ce208ae.5292978","name":"","property":"ConversationOUT.cmdtype","propertyType":"msg","rules":[{"t":"eq","v":"INTEND","vt":"str"},{"t":"eq","v":"KEYBOARD","vt":"str"},{"t":"eq","v":"TEXT","vt":"str"},{"t":"else"}],"checkall":"true","outputs":4,"x":266.04998779296875,"y":497.8500518798828,"wires":[["c96b31c8.12f718"],["51fe0090.b5db9"],["8c74179c.a129d"],["31b5dc94.fca1dc"]]},{"id":"c96b31c8.12f718","type":"function","z":"ce208ae.5292978","name":"prep","func":"msg.payload = {};\nmsg.payload._id = msg.ConversationOUT.command.toString();\nreturn msg;","outputs":1,"noerr":0,"x":457.050048828125,"y":440.8500289916992,"wires":[["8e408a37.e7fa3"]]},{"id":"8e408a37.e7fa3","type":"cloudant in","z":"ce208ae.5292978","name":"","cloudant":"","database":"wea_qa","service":"cloudant-nosql-db","search":"_id_","design":"","index":"","x":604.0500183105469,"y":440.8500289916992,"wires":[["bd38c83e.dabc28"]]},{"id":"bd38c83e.dabc28","type":"function","z":"ce208ae.5292978","name":"getText","func":"msg.ConversationOUT.text = msg.payload.chat;\nreturn msg;","outputs":1,"noerr":0,"x":776.0500183105469,"y":440.8500289916992,"wires":[["8c74179c.a129d"]]},{"id":"92aa3e18.135038","type":"catch","z":"ce208ae.5292978","name":"","scope":null,"x":100.16667175292969,"y":975.933349609375,"wires":[["761d268d.40fb88"]]},{"id":"761d268d.40fb88","type":"debug","z":"ce208ae.5292978","name":"","active":true,"console":"false","complete":"error","x":1231.1666107177734,"y":980.4000244140625,"wires":[]},{"id":"bde710ae.7b1e5","type":"link out","z":"ce208ae.5292978","name":"bot_command","links":["d198fcb9.1d0678"],"x":1053.9666290283203,"y":178.9000244140625,"wires":[]},{"id":"d198fcb9.1d0678","type":"link in","z":"ce208ae.5292978","name":"","links":["bde710ae.7b1e5"],"x":145.96665954589844,"y":795.7332763671875,"wires":[["7bc8d17c.6a5148"]]},{"id":"7bc8d17c.6a5148","type":"switch","z":"ce208ae.5292978","name":"bot_command","property":"sourceMsg.payload.content","propertyType":"msg","rules":[{"t":"eq","v":"/reinicia","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":274.96669006347656,"y":795.5165786743164,"wires":[["5761242e.d71ae4"],["4ca9b59b.2f4f54"]]},{"id":"5761242e.d71ae4","type":"function","z":"ce208ae.5292978","name":"reset dialog","func":"msg.session_status = \"new\";\nreturn msg;","outputs":1,"noerr":0,"x":483.9667205810547,"y":757.9666748046875,"wires":[["92cf7706.7b9558"]]},{"id":"92cf7706.7b9558","type":"link out","z":"ce208ae.5292978","name":"to_prepareDialog","links":["23893be5.15a67c"],"x":607.9666900634766,"y":758.199951171875,"wires":[]},{"id":"23893be5.15a67c","type":"link in","z":"ce208ae.5292978","name":"","links":["92cf7706.7b9558","4c0a71a1.41ae38","39dbee43.4266fa"],"x":59.96669006347656,"y":309.0333251953125,"wires":[["fb545e6a.250d38"]]},{"id":"4c0a71a1.41ae38","type":"link out","z":"ce208ae.5292978","name":"","links":["23893be5.15a67c"],"x":986.9665985107422,"y":202.20001220703125,"wires":[]},{"id":"39dbee43.4266fa","type":"link out","z":"ce208ae.5292978","name":"","links":["23893be5.15a67c"],"x":1115.966567993164,"y":810.1999588012695,"wires":[]},{"id":"bfa3f424.12e6e8","type":"link in","z":"ce208ae.5292978","name":"voice_process","links":["e0a7dd70.61383"],"x":741.9666900634766,"y":773.0332946777344,"wires":[["197277b1.d19918"]]},{"id":"e0a7dd70.61383","type":"link out","z":"ce208ae.5292978","name":"","links":["bfa3f424.12e6e8"],"x":987.9665985107422,"y":158.20000457763672,"wires":[]},{"id":"4ca9b59b.2f4f54","type":"debug","z":"ce208ae.5292978","name":"","active":false,"console":"false","complete":"sourceMsg","x":495.96669006347656,"y":833.9000244140625,"wires":[]},{"id":"23600c12.6a6124","type":"link out","z":"ce208ae.5292978","name":"command_process","links":["d29a5b12.46626"],"x":1206.9666748046875,"y":307.45001220703125,"wires":[]},{"id":"d29a5b12.46626","type":"link in","z":"ce208ae.5292978","name":"","links":["23600c12.6a6124","1446e9ce.e6bbd6"],"x":156.9666748046875,"y":470.3833541870117,"wires":[["2d3c19e2.ef598e"]]},{"id":"754e71a.4fd8d1","type":"debug","z":"ce208ae.5292978","name":"","active":true,"console":"false","complete":"ConversationOUT","x":1303.966552734375,"y":355.3999938964844,"wires":[]},{"id":"9c5557f1.bded1","type":"comment","z":"ce208ae.5292978","name":"Voice to Text","info":"","x":795.9666595458984,"y":737.1666564941406,"wires":[]},{"id":"cff14cf7.2534d8","type":"comment","z":"ce208ae.5292978","name":"BOT commands","info":"","x":210.96665954589844,"y":757.1666259765625,"wires":[]},{"id":"39a7e452.71ac94","type":"comment","z":"ce208ae.5292978","name":"INTEND Cmd","info":"","x":476.9666748046875,"y":405.1666793823242,"wires":[]},{"id":"e617828e.86e48","type":"comment","z":"ce208ae.5292978","name":"Txt Message","info":"","x":118.96665954589844,"y":270.16668701171875,"wires":[]},{"id":"7e9184fe.722394","type":"comment","z":"ce208ae.5292978","name":"Dialog Cmds","info":"","x":205.9666748046875,"y":428.1666793823242,"wires":[]},{"id":"504ee287.cb40dc","type":"comment","z":"ce208ae.5292978","name":"Answer & Save","info":"","x":485.9666748046875,"y":575.1666870117188,"wires":[]},{"id":"51fe0090.b5db9","type":"function","z":"ce208ae.5292978","name":"Keyboard Reply","func":"// Save dialog response\nvar responseMsg = msg.payload.output.text;\n\nmsg.ConversationOUT.text = msg.ConversationOUT.command;\n//msg.dialogOUT.text = msg.dialogOUT.text.concat(\"\\n\").concat(responseMsg[1]);\n\nvar opts = {\n    reply_markup :{\n        keyboard: JSON.parse(responseMsg[1]),\n        'resize_keyboard' : true,\n        'one_time_keyboard' : true\n    }\n};\nmsg.ConversationOUT.options = opts;\nmsg.ConversationOUT.timestamp = Date.now();\nreturn msg;","outputs":1,"noerr":0,"x":486.70001220703125,"y":489.7000045776367,"wires":[["8c74179c.a129d"]]},{"id":"3ac34082.792f8","type":"link in","z":"ce208ae.5292978","name":"resume_dialog","links":["b44a8065.87e868","d314a973.e2ad"],"x":490.9666748046875,"y":280.13336181640625,"wires":[["55e1c17e.a3f348"]]},{"id":"31b5dc94.fca1dc","type":"link out","z":"ce208ae.5292978","name":"defaultCmd","links":["3c4961cf.01342e"],"x":297.85003662109375,"y":574.8499755859375,"wires":[]},{"id":"3c4961cf.01342e","type":"link in","z":"ce208ae.5292978","name":"","links":["31b5dc94.fca1dc"],"x":148.84999084472656,"y":895.8499755859375,"wires":[["1610fdb1.2aa97a"]]},{"id":"1610fdb1.2aa97a","type":"function","z":"ce208ae.5292978","name":"Default for external catch","func":"// Here you can do whatever you want, even create your own commands\n\n// In the dialog tempalte this will go to an input node \n// that will show a default message\nmsg.payload = \"%%DEFAULT%%\"\nreturn msg;","outputs":1,"noerr":0,"x":276.8500061035156,"y":900.8499755859375,"wires":[["d314a973.e2ad","2b415746.546bd8","567cd4d1.cd1714"]]},{"id":"d314a973.e2ad","type":"link out","z":"ce208ae.5292978","name":"","links":["3ac34082.792f8"],"x":462.8499755859375,"y":873.8499755859375,"wires":[]},{"id":"a7cac91b.e46998","type":"debug","z":"ce208ae.5292978","name":"","active":true,"console":"false","complete":"params","x":314.65000915527344,"y":254.64999389648438,"wires":[]},{"id":"8c74179c.a129d","type":"function","z":"ce208ae.5292978","name":"bypass holder","func":"\nreturn msg;","outputs":1,"noerr":0,"x":485.65000915527344,"y":616.6500091552734,"wires":[["24405fc3.8b66e8","e3d80864.90638","7e921813.9c258"]]},{"id":"33c0a745.1e129","type":"subflow:39a41763.6aed08","z":"ce208ae.5292978","x":1073.1165618896484,"y":772.3166275024414,"wires":[["596969da.512b98"]]},{"id":"55e1c17e.a3f348","type":"watson-conversation-v1","z":"ce208ae.5292978","name":"","workspaceid":"52866da8-1666-46aa-a211-2584434ce125","x":606.1166839599609,"y":308.41668701171875,"wires":[["ad195ba3.22a49","2f309672.b4947a"]]},{"id":"c0482842.47b8a","type":"debug","z":"ce208ae.5292978","name":"","active":true,"console":"false","complete":"false","x":654.1166687011719,"y":45,"wires":[]},{"id":"2b415746.546bd8","type":"debug","z":"ce208ae.5292978","name":"","active":false,"console":"false","complete":"params.context","x":546.1166534423828,"y":939.0000076293945,"wires":[]},{"id":"2f309672.b4947a","type":"debug","z":"ce208ae.5292978","name":"","active":true,"console":"false","complete":"false","x":829.11669921875,"y":350,"wires":[]},{"id":"3ee84d52.600ec2","type":"link in","z":"ce208ae.5292978","name":"Save Profile","links":["567cd4d1.cd1714"],"x":602.11669921875,"y":571.3333129882812,"wires":[["7e921813.9c258"]]},{"id":"567cd4d1.cd1714","type":"link out","z":"ce208ae.5292978","name":"","links":["3ee84d52.600ec2"],"x":503.8333740234375,"y":901.3333740234375,"wires":[]},{"id":"bf85e859.10a658","type":"function","z":"ce208ae.5292978","name":"prepare Profile saving","func":"// Update context\nmsg.profile.lastConversation.context = msg.payload;\n\n// Put save timestamp\nmsg.profile.lastTimestamp = Date.now();\n\n// Add dialogOut to history\nmsg.profile.history.push(msg.ConversationOUT);\n\n// Put profile on payload, to be stored\nmsg.payload = msg.profile\n\nreturn msg;","outputs":1,"noerr":0,"x":1166.6666259765625,"y":584.6666870117188,"wires":[["a9bdc995.ca5a3"]]},{"id":"7e921813.9c258","type":"function","z":"ce208ae.5292978","name":"prepare merge Contexts","func":"\n// Prepare for NPM merge function (next node)\n\nif (msg.ConversationOUT.newContext)\n    msg.payload = [ msg.settings.context, msg.ConversationOUT.newContext ];\nelse \n    msg.payload = [ msg.settings.context , {} ];\nreturn msg;","outputs":1,"noerr":0,"x":762.0499267578125,"y":585.85009765625,"wires":[["93d0c4e5.89316"]]},{"id":"93d0c4e5.89316","type":"npm","z":"ce208ae.5292978","name":"","func":"// NPM module exposed as variable, npm_module\nreturn npm_module(msg.payload[0], msg.payload[1]);","npm_module":"merge","module_style":"custom","msg_payload":"return_val","function_name":"merge","x":957.8333129882812,"y":585.3333740234375,"wires":[["bf85e859.10a658"]]},{"id":"bc463ef3.f6d2a","type":"telegram bot","z":"","botname":"@WatsonVAbot","usernames":"[]","chatids":"[]"}]